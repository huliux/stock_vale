# 项目规范

## 文档规范

- 所有变更需同步更新cline_docs中的对应文档
- README.md需保持与当前版本功能一致
- 技术决策记录在cline_docs/systemPatterns.md

## 架构规范

- **后端 (FastAPI):**
    - 采用分层架构（例如：API层、服务层、数据访问层）。
    - API 路由遵循 RESTful 设计原则。
    - 使用依赖注入（Dependency Injection）管理服务和数据库连接。
    - 数据获取层采用策略模式支持多市场。
- **前端 (Next.js):**
    - 遵循 App Router 结构。
    - 组件化开发，区分 UI 组件和功能组件。
- **通用:**
    - 错误处理统一规范（例如，定义通用的错误响应模型）。

## 代码规范

- 严格遵循PEP8编码规范
- 必须使用类型注解(Type Hints)
- 金融计算使用decimal模块
- 数据类优先使用 Pydantic 模型（尤其用于 API 请求/响应和数据校验）。
- 配置文件使用 `.env` 管理敏感信息。
- 禁止在代码中硬编码敏感信息。
- **FastAPI:**
    - 路由函数参数和响应体使用 Pydantic 模型和类型提示。
- **TypeScript/React (前端):**
    - 遵循 `.clinerules/05-code-style.md` 中定义的前端规范。
- **业务逻辑遵循:** **核心业务逻辑实现必须严格遵守 `wiki/` 目录下的产品需求文档 (PRD) 和数据定义，任何偏差需明确记录和批准。**

## 测试规范

- **使用 `pytest` 作为主要的测试框架。**
- 核心估值算法覆盖率需达到100%
- 数据获取模块需实现mock测试
- HTML报告需进行视觉回归测试
- 使用pytest-fixture管理测试数据
- 集成测试覆盖所有估值模型
- **后端:** 必须包含对 FastAPI 端点的单元测试和集成测试。
- **前端:** (推荐) 包含对关键组件和功能的单元测试或集成测试。

## 安全规范

- **强烈推荐使用 `.env` 文件和 `python-dotenv` 库管理环境变量（如 API 密钥、数据库凭证）。`.env` 文件必须添加到 `.gitignore`。**
- 数据库连接信息必须使用环境变量（通过 `.env` 加载）
- **API 输入验证:** 使用 Pydantic 严格验证所有 API 请求的输入数据。
- **API 输出过滤:** 确保 API 响应不包含敏感信息。
- **依赖安全:** 定期检查项目依赖是否存在已知的安全漏洞。
- (可选) API 请求考虑实现认证和授权机制。
- (可选) API 请求考虑实现限流机制。
- 日志文件不得记录敏感数据。
